from flask import Flask, Response, jsonify, request
from wascan import wascan
from lib.utils.Scanner import Scanner
import json

app = Flask(__name__)

responseObject = {  # This is a example of response from REST API
    'Status': '',  # HTTP status (200, 404, 400, 201, etc)
    'URL_Tested': '',  # URL Tested
    'Results': ''  # scanned vulnerability objects  will be added
}


@app.route('/')
def hello_world():
    return 'Web Vulnerabilities Scaner'


@app.route('/scanner/start', methods=['POST'])
def start():
    request_data = request.get_json()
    url = request_data['url']
    vulnerabilities = request_data['vulnerabilities']
    scanner = Scanner(url, vulnerabilities)
    if valid_json_format(request_data):
        responseObject['Results'] = scanner.start()
        responseObject['Status'] = 200
        responseObject['URL_Tested'] = url
    response = Response(json.dumps(responseObject), status=200, mimetype="application/json")
    return response


def valid_json_format(request_json):
    if "url" in request_json and "vulnerabilities" in request_json:
        return True
    else:
        return False


#previous code
# @app.route('/login', methods=['POST', 'GET'])
# def login():
#     if request.method == 'POST':
#         a = wascan()
#         a.main()
#         return 'Test'
#     else:
#         return 'Method get, nothing happens'


app.run(debug=True, host='0.0.0.0')
